# Implementation Plan: Manual Annotations

**Branch**: `018-annotate` | **Date**: 2026-01-28 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/018-annotate/spec.md`

## Summary

Add manual annotations with "infinite authority" to the knowledge graph. Annotations attach to concepts and cannot be overwritten by automated tools (LLM scans). Implements CRUD operations following existing mind.db patterns.

## Technical Context

**Language/Version**: TypeScript (Bun runtime)
**Primary Dependencies**: CozoDB (cozo-node), existing mind.ts utilities
**Storage**: CozoDB `.brane/mind.db` (RocksDB backend)
**Testing**: tc tests (JSON in/out)
**Target Platform**: CLI (local-first)
**Project Type**: Single project (existing Brane structure)
**Performance Goals**: < 1 second for all operations, handles 1000+ annotations
**Constraints**: Result envelope pattern, POD only, snake_case naming
**Scale/Scope**: Extends existing mind.db schema with new `annotations` relation

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. POD Only | PASS | All annotation data is plain JSON objects |
| II. Result Envelope | PASS | All handlers return standard Result shape |
| III. sys.call Public API | PASS | Handlers are thin adapters to mind.ts |
| IV. Antagonistic Testing | PASS | tc tests before implementation |
| V. Unix-Clean | PASS | Exit codes, null over undefined |
| VI. Simplicity | PASS | Minimal new code, follows existing patterns |

## Project Structure

### Documentation (this feature)

```text
specs/018-annotate/
├── plan.md              # This file
├── research.md          # Design decisions
├── data-model.md        # Annotation entity definition
├── quickstart.md        # Usage examples
├── contracts/           # API endpoint specs
│   └── mind-annotations.md
└── tasks.md             # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
src/
├── handlers/mind/
│   └── annotations/
│       ├── create.ts    # POST /mind/annotations/create
│       ├── list.ts      # GET /mind/annotations/list
│       ├── get.ts       # GET /mind/annotations/get
│       └── delete.ts    # DELETE /mind/annotations/delete
├── lib/
│   └── mind.ts          # Add annotation helpers (extend existing)
└── index.ts             # Route registration

tests/mind/annotations/
├── run                  # Test runner
└── data/
    ├── 00-success-create/
    ├── 01-success-list/
    ├── 02-success-get/
    ├── 03-success-delete/
    ├── 04-error-not-initialized/
    ├── 05-error-concept-not-found/
    ├── 06-error-annotation-not-found/
    ├── 07-success-filter-by-target/
    └── 08-success-filter-by-type/
```

**Structure Decision**: Follows existing mind handlers pattern (`/mind/concepts/*`, `/mind/edges/*`). Four handlers in `annotations/` subdirectory.

## Complexity Tracking

No violations. Feature follows established patterns:
- Same handler structure as concepts/edges
- Same mind.ts helper pattern
- Same tc test structure
