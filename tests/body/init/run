#!/usr/bin/env bash
#
# Test runner for /body/init
#
set -e

BRANE_ROOT="$(cd "$(dirname "$0")/../../.." && pwd)"
source "$BRANE_ROOT/tests/lib.sh"

INPUT=$(cat)
workspace

case "$TC_CASE_NAME" in
  *-idempotent*)
    init_body
    ;;
  *-custom-path*)
    rm -rf /tmp/brane-test-custom
    mkdir -p /tmp/brane-test-custom
    ;;
  *-brane-is-file*)
    touch .brane
    ;;
esac

echo "$INPUT" | bun run "$BRANE_ROOT/src/cli.ts" /body/init
